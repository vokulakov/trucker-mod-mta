local function req() local a={VERSION='0.1'}local b=1;a.defaults={depth_limit=false,show_nil=true,show_boolean=true,show_number=true,show_string=true,show_table=true,show_function=false,show_thread=false,show_userdata=false,show_metatable=false,show_all=false,use_tostring=false,filter_function=nil,object_cache='local',indent_size=2,level_width=80,wrap_string=true,wrap_array=false,sort_keys=true}local c={['nil']=1,['boolean']=2,['number']=3,['string']=4,['table']=5,['function']=6,['thread']=7,['userdata']=8}local d={['\a']='\\a',['\b']='\\b',['\f']='\\f',['\n']='\\n',['\r']='\\r',['\t']='\\t',['\v']='\\v',['\\']='\\\\'}local function e(f)f=f:gsub('([%c\\])',d)local g=f:find('"')local h=f:find("'")if g and h then return f:gsub('"','\\"'),'"'elseif h then return f,'"'else return f,"'"end end;local function i(j)return type(j)=='string'and j:match('^[%a_][%a%d_]*$')end;local k={['table']=true,['function']=true,['thread']=true,['userdata']=true}local function l(m,n,o)if not n.visited_tables then n.visited_tables=setmetatable({},{__mode='k'})end;local p=type(m)if not c[p]and not o.show_table or c[p]and not o['show_'..p]then return end;if k[p]or c[p]==nil then if not n[p]then n[p]=setmetatable({},{__mode='k'})n[p]._cnt=0 end;if not n[p][m]then n[p]._cnt=n[p]._cnt+1;n[p][m]=n[p]._cnt end end;if p=='table'or c[p]==nil then if n.visited_tables[m]==false then return elseif n.visited_tables[m]==nil then n.visited_tables[m]=1 else n.visited_tables[m]=n.visited_tables[m]+1;return end;for q,r in pairs(m)do l(q,n,o)l(r,n,o)end;local s=getmetatable(m)if s and o.show_metatable then l(s,n,o)end end end;local function t(u,v)while#u>0 and#v>0 do local w,x=u:find('%d+')local y,z=v:find('%d+')if not(w and y)then return u<v end;local A=u:sub(1,w-1)local B=v:sub(1,y-1)if A~=B then return A<B end;local C=tonumber(u:sub(w,x))local D=tonumber(v:sub(y,z))if C~=D then return C<D end;u=u:sub(x+1)v=v:sub(z+1)end;return u<v end;local function E(u,v)local F=type(u)local G=type(v)if F=='number'and G=='number'then return u<v end;if F=='string'and G=='string'then return t(u,v)end;if F==G then return t(tostring(u),tostring(v))end;local H=c[F]or 9;local I=c[G]or 9;return H<I end;local function J(o)if o==nil then o={}end;for q,r in pairs(a.defaults)do if o[q]==nil then o[q]=r end;if o.show_all then for p,K in pairs(c)do o['show_'..p]=true end;o.show_metatable=true end end;return o end;function a.setup(o)a.defaults=J(o)end;function a.pformat(m,o,L)o=J(o)local M={}local function N(f)table.insert(M,f)end;L=L or N;local n;if o.object_cache=='global'then n=a._cache or{}a._cache=nil elseif o.object_cache=='local'then n={}end;local O=''local P={indent='',len=0}local Q=function(f)L(O)O=f end;local function R(S)P.indent=string.rep(' ',S+#P.indent)end;local function T(S)Q('\n')Q(P.indent)if S then R(S)end;P.len=0;return true end;local function U(f,V)P.len=P.len+#f;if not V and P.len>o.level_width then T()Q(f)P.len=#f else Q(f)end end;local W={}local function X(r)local Y=W[type(r)]Y=Y or W.table;if o.filter_function and o.filter_function(r,nil,nil)then return''else return Y(r)end end;local function Z(r)return tostring(r)end;local function _(a0)return a0==math.huge and'[[math.huge]]'or tostring(a0)end;local function a1(r)return''end;local function a2(p,a3)if a3 then return function(r)return string.format('[[%s %d]]',p,n[p][r])end else return function(r)return'[['..p..']]'end end end;local function a4(f,a5)local f,a6=e(f)local a7=a5 and 4 or 2;if a7+#f+P.len>o.level_width then T()if o.wrap_string and#f+a7>o.level_width then U('[[')while#f+P.len>=o.level_width do local a8=o.level_width-P.len;U(string.sub(f,1,a8),true)T()f=string.sub(f,a8+1)end;U(f)return']]'end end;return a5 and'[['..f..']]'or a6 ..f..a6 end;local function a9(p)if o.use_tostring then local s=getmetatable(p)if s and s.__tostring then return a4(tostring(p),true)end end;local aa=nil;local ab=type(p)if o.object_cache then local ac=n.visited_tables[p]local ad=n[ab][p]if ac==false then return a4(string.format('%s %d',ab,ad),true)elseif ac>1 then aa=ad;n.visited_tables[p]=false else end end;local ae=tonumber(o.depth_limit)if ae and b>ae then if aa then return string.format('[[%s %d]]...',ab,aa)end;return a4(tostring(p),true)end;local af=#p;local ag=false;U('{')R(o.indent_size)U(string.rep(' ',o.indent_size-1))if aa then U(string.format('--[[%s %d]] ',ab,aa))end;for ah=1,af do local r=p[ah]if W[type(r)]==a1 or o.filter_function and o.filter_function(r,ah,p)then else if o.wrap_array then ag=T()end;b=b+1;U(X(r)..', ')b=b-1 end end;local function ai(q)local aj=tonumber(q)if aj~=q or aj>af then return true end end;local function ak(q,r,p)if W[type(r)]==a1 or W[type(q)]==a1 or o.filter_function and o.filter_function(r,q,p)then return end;ag=T()if i(q)then U(q,true)else U('[')local q=X(q)if string.match(q,'%[%[')then U(' '..q..' ',true)else U(q,true)end;U(']')end;U(' = ',true)b=b+1;U(X(r),true)b=b-1;U(',',true)end;if o.sort_keys then local al={}for q,K in pairs(p)do if ai(q)then table.insert(al,q)end end;table.sort(al,E)for K,q in ipairs(al)do ak(q,p[q],p)end else for q,r in pairs(p)do if ai(q)then ak(q,r,p)end end end;if o.show_metatable then local s=getmetatable(p)if s then ak('__metatable',s,p)end end;R(-o.indent_size)O=string.gsub(O,'^ +$','')O=string.gsub(O,',%s*$',' ')if ag then T()end;U('}')return''end;W['nil']=o.show_nil and Z or a1;W['boolean']=o.show_boolean and Z or a1;W['number']=o.show_number and _ or a1;W['function']=o.show_function and a2('function',o.object_cache)or a1;W['thread']=o.show_thread and a2('thread',o.object_cache)or a1;W['userdata']=o.show_userdata and a2('userdata',o.object_cache)or a1;W['string']=o.show_string and a4 or a1;W['table']=o.show_table and a9 or a1;if o.object_cache then l(m,n,o)end;U(X(m))L(O)if o.object_cache=='global'then a._cache=n end;return table.concat(M)end;function a.pprint(...)local am={...}local an=select('#',...)for ah=1,an do a.pformat(am[ah],nil,io.write)io.write('\n')end end;setmetatable(a,{__call=function(K,...)a.pprint(...)end}) return a end
pprint = req()
